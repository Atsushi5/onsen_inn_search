'''
storing inn data we get

input : none

function : 
1: to call the function from jaran_onsen_api.py at each area id and get the data of all inns existing within that area.  
2: to store all the inns' data we get into our database by mapping the all inns' data to our onsen inn model

output : none
'''

import os
import sys, getopt
import urllib.request
from bs4 import BeautifulSoup
from xml.dom.minidom import parseString
from scrape_onsen_html import scrapeOnsenHtml

sys.path.append("..")
sys.path.append("../..")
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'onsen_inn_search.setting\
s')
import django
django.setup()

from onsen_inns.models import Onsen, OnsenInn

def main():

    inn_data = []
    
    onsens = Onsen.objects.all()
    for onsen in onsens:
        onsen_id = onsen.onsen_id
        onsen_area_id = onsen.onsen_area_id

        if onsen_area_id is None:
            continue

        url = "https://www.jalan.net/onsen/OSN_" + str(onsen_area_id) + ".html"
        inn_data = scrapeOnsenHtml(url)
        storeInnData(onsen, inn_data)

def storeInnData(onsen, inn_data):
    i = 0
    for data in inn_data:
        if not OnsenInn.objects.filter(inn_id=i).exists():
            onsen_inn = OnsenInn()
            '''onsen_inn.inn_id = data[0]
            onsen_inn.inn_name = data[1]
            onsen_inn.inn_photo = data[2]
            onsen_inn.inn_min_price = data[3]
            onsen_inn.review_room = data[4]
            onsen_inn.review_bath = data[5]            
            onsen_inn.review_breakfast = data[6]
            onsen_inn.review_dinner = data[7]
            onsen_inn.review_service = data[8]
            onsen_inn.review_cleaness = data[9]
            onsen_inn.rooms_total = data[10]
            onsen_inn.baths_total = data[11]
            onsen_inn.free_wifi = data[12]
            onsen_inn.convenience_store = data[13]
            onsen_inn.hand_towel = data[14]
            onsen_inn.dental_amenities = data[15]
            onsen_inn.bath_towel = data[16]
            onsen_inn.shampoo = data[17]
            onsen_inn.conditioner = data[18]
            onsen_inn.body_wash = data[19]
            onsen_inn.bar_soap = data[20]
            onsen_inn.yukata = data[21]
            onsen_inn.pajamas = data[22]
            onsen_inn.bathrobe = data[23]
            onsen_inn.hairdryer = data[24]
            onsen_inn.duvet = data[25]
            onsen_inn.razor = data[26]
            onsen_inn.shower_cap = data[27]
            onsen_inn.cotton_swab = data[28]
            onsen_inn.onsui_toilet = data[29]
            onsen_inn.hair_brush = data[30]
            onsen_inn.category = data[31]
            onsen_inn.onsen = onsen'''
            onsen_inn.inn_id = i
            onsen_inn.inn_name = data[0]
            #onsen_inn.inn_photo = data[2]
            onsen_inn.inn_min_price = 10000
            onsen_inn.review_room = 4.5
            onsen_inn.review_bath = 3.3
            onsen_inn.review_breakfast = 4.8
            onsen_inn.review_dinner = 5.0
            onsen_inn.review_service = 4.3
            onsen_inn.review_cleaness = 2.0
            if data[1] != '':
                onsen_inn.rooms_total = int(data[1])
            else:
                onsen_inn.rooms_total = None
            onsen_inn.baths_total = 10
            onsen_inn.free_wifi = True
            onsen_inn.convenience_store = True
            onsen_inn.hand_towel = True
            onsen_inn.dental_amenities = True
            onsen_inn.bath_towel = True
            onsen_inn.shampoo = False
            onsen_inn.conditioner = True
            onsen_inn.body_wash = False
            onsen_inn.bar_soap = True
            onsen_inn.yukata = False
            onsen_inn.pajamas = True
            onsen_inn.bathrobe = False
            onsen_inn.hairdryer = True
            onsen_inn.duvet = False
            onsen_inn.razor = False
            onsen_inn.shower_cap = True
            onsen_inn.cotton_swab = True
            onsen_inn.onsui_toilet = True 
            onsen_inn.hair_brush = True
            onsen_inn.category = 1
            onsen_inn.onsen = onsen
            onsen_inn.save()
        i+=1

if __name__ == "__main__":

    main()
